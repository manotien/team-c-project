# User Story 6.1: Display Total Payments for Current Month

**Story ID:** US-6.1
**Epic:** [EPIC-6: Monthly Summary](epic-6-monthly-summary.md)
**Priority:** Medium (P2)
**Status:** Ready for Development

---

## User Story

**As a** user
**I want to** see a card with my total payments this month
**So that** I can track my monthly bill spending

---

## Story Context

**Existing System Integration:**
- Integrates with: Task management system (Epic 4)
- Technology: Next.js Server Components, Prisma, React
- Follows pattern: Dashboard card components with server-side data fetching
- Touch points: Dashboard page, Task model (`paidAt` field), Bill model (`amount` field)

---

## Acceptance Criteria

**Functional Requirements:**

1. Summary card displayed on dashboard (prominent position)
2. Card shows current month name and year ("October 2025")
3. Displays total amount paid this month (sum of all PAID tasks in current month)
4. Amount formatted with currency: "฿4,850.00"
5. Count of bills paid this month: "5 bills paid"
6. Card styled distinctively (larger, highlighted, or separate section)
7. Updates automatically when task marked as paid
8. Shows ฿0.00 if no bills paid this month
9. Month calculation based on `task.paidAt` field

**Integration Requirements:**

10. Existing task functionality continues to work unchanged
11. New functionality follows existing dashboard card pattern
12. Integration with task payment system maintains current behavior

**Quality Requirements:**

13. Change is covered by appropriate tests
14. Documentation is updated if needed
15. No regression in existing functionality verified

---

## Technical Notes

**Query Implementation:**
```typescript
const startOfMonth = new Date(year, month, 1);
const endOfMonth = new Date(year, month + 1, 0, 23, 59, 59);

const paidTasks = await prisma.task.findMany({
  where: {
    userId,
    status: 'PAID',
    paidAt: {
      gte: startOfMonth,
      lte: endOfMonth
    }
  },
  include: { bill: true }
});

const total = paidTasks.reduce((sum, task) => sum + Number(task.bill.amount), 0);
```

- **Integration Approach:** Use server component for data fetching
- **Component Location:** `components/summaries/MonthlySummaryCard.tsx`
- **Existing Pattern Reference:** Follow dashboard card components in `components/` directory
- **Key Constraints:**
  - Use user's timezone (default: Asia/Bangkok) for month boundaries
  - Store `paidAt` in UTC, convert for display
  - Database index required on `(user_id, status, paid_at)`

---

## Risk and Compatibility Check

**Minimal Risk Assessment:**
- **Primary Risk:** Incorrect month calculation due to timezone issues
- **Mitigation:** Use user's timezone for month boundaries, test with edge cases (end of month)
- **Rollback:** Remove component from dashboard, no data modifications needed

**Compatibility Verification:**
- [x] No breaking changes to existing APIs
- [x] Database changes (if any) are additive only (index on existing columns)
- [x] UI changes follow existing design patterns (dashboard cards)
- [x] Performance impact is negligible (optimized query with index)

---

## Definition of Done

- [ ] Functional requirements met (AC 1-9)
- [ ] Integration requirements verified (AC 10-12)
- [ ] Existing functionality regression tested
- [ ] Code follows existing patterns and standards
- [ ] Tests pass (existing and new)
- [ ] Currency formatting consistent (฿ symbol, 2 decimals)
- [ ] Empty state handled (฿0.00, 0 bills)
- [ ] Unit tests for summary calculation logic
- [ ] Documentation updated if applicable

---

## Dependencies

**Upstream Dependencies:**
- Epic 4 (Task Actions): Requires `paidAt` timestamp on tasks

---

## Notes

- **UI Framework:** Use shadcn/ui Card component
- **Date Utilities:** Use date-fns for month calculations
- **Future Enhancements:** Month selector, year-to-date total, category breakdown
