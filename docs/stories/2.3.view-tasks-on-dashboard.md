# US-2.3: View Tasks on Dashboard

**Story ID:** US-2.3
**Epic:** [Epic 2: Task Creation](epic-2-task-creation.md)
**Priority:** Critical (P0)
**Story Points:** 3
**Status:** Ready for Development

---

## User Story

**As a** user
**I want to** view my tasks on the dashboard
**So that** I can see what bills I need to pay

---

## Acceptance Criteria

- [ ] Dashboard shows "My Tasks" section
- [ ] Tasks sorted by due date (earliest first)
- [ ] Each task card displays:
  - [ ] Bill vendor name
  - [ ] Bill amount with currency (฿1,500.00)
  - [ ] Due date in readable format ("Oct 15, 2025")
  - [ ] Bill type icon (⚡💧🌐🚗🏠)
  - [ ] Task status badge (UNPAID/PAID)
- [ ] Click task card to view bill details
- [ ] Empty state message if no tasks: "No bills to pay yet"
- [ ] Tasks filtered to current user only (WHERE userId = currentUser.id)

---

## Technical Implementation

### Backend Implementation

**File:** `app/(dashboard)/dashboard/page.tsx`

```typescript
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";
import { prisma } from "@/lib/prisma";
import TaskList from "@/components/TaskList";

export default async function DashboardPage() {
  const session = await getServerSession(authOptions);

  if (!session?.user?.id) {
    redirect("/login");
  }

  const tasks = await prisma.task.findMany({
    where: { userId: session.user.id },
    include: { bill: true },
    orderBy: { dueDate: "asc" },
  });

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">My Dashboard</h1>
      <TaskList tasks={tasks} />
    </div>
  );
}
```

### Frontend Components

**File:** `components/TaskList.tsx`

```typescript
"use client";

import TaskCard from "./TaskCard";

interface TaskWithBill extends Task {
  bill: Bill;
}

interface TaskListProps {
  tasks: TaskWithBill[];
}

export default function TaskList({ tasks }: TaskListProps) {
  if (tasks.length === 0) {
    return (
      <div className="text-center py-12 text-gray-500">
        <p>No bills to pay yet</p>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      <h2 className="text-xl font-semibold mb-4">My Tasks</h2>
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {tasks.map((task) => (
          <TaskCard key={task.id} task={task} />
        ))}
      </div>
    </div>
  );
}
```

**File:** `components/TaskCard.tsx`

```typescript
"use client";

import Link from "next/link";
import { formatCurrency, formatDate } from "@/lib/utils";
import { getBillTypeIcon } from "@/lib/billTypes";

interface TaskCardProps {
  task: Task & { bill: Bill };
}

export default function TaskCard({ task }: TaskCardProps) {
  const { bill } = task;

  return (
    <Link href={`/tasks/${task.id}`}>
      <div className="border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer">
        <div className="flex items-start gap-3">
          {/* Bill Type Icon */}
          <div className="text-3xl">{getBillTypeIcon(bill.type)}</div>

          {/* Task Details */}
          <div className="flex-1">
            <h3 className="font-semibold text-lg">{bill.vendor}</h3>
            <p className="text-xl font-bold text-blue-600 mt-1">
              {formatCurrency(bill.amount)}
            </p>
            <p className="text-sm text-gray-600 mt-2">
              Due: {formatDate(task.dueDate)}
            </p>
          </div>

          {/* Status Badge */}
          <div>
            <span
              className={`px-3 py-1 rounded-full text-xs font-medium ${
                task.status === "PAID"
                  ? "bg-green-100 text-green-700"
                  : "bg-yellow-100 text-yellow-700"
              }`}
            >
              {task.status}
            </span>
          </div>
        </div>
      </div>
    </Link>
  );
}
```

**File:** `lib/billTypes.ts`

```typescript
export const BILL_TYPE_ICONS: Record<string, string> = {
  electricity: "⚡",
  water: "💧",
  internet: "🌐",
  car: "🚗",
  rent: "🏠",
};

export function getBillTypeIcon(type: string): string {
  return BILL_TYPE_ICONS[type] || "📄";
}
```

**File:** `lib/utils.ts`

```typescript
export function formatCurrency(amount: number | string): string {
  const numAmount = typeof amount === "string" ? parseFloat(amount) : amount;
  return `฿${numAmount.toLocaleString("th-TH", {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  })}`;
}

export function formatDate(date: Date | string): string {
  const dateObj = typeof date === "string" ? new Date(date) : date;
  return dateObj.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
}
```

---

## UI/UX Design

### Task Card Layout

```
┌──────────────────────────────────────────┐
│  ⚡  Internet Bill           [UNPAID]    │
│      ฿1,500.00                           │
│      Due: Oct 15, 2025                   │
└──────────────────────────────────────────┘
```

### Empty State

```
┌──────────────────────────────────────────┐
│                                          │
│         No bills to pay yet              │
│                                          │
└──────────────────────────────────────────┘
```

### Dashboard Layout

```
My Dashboard
─────────────────────────────────────────

My Tasks
─────────────────────────────────────────

┌─────────┐  ┌─────────┐  ┌─────────┐
│ Task 1  │  │ Task 2  │  │ Task 3  │
└─────────┘  └─────────┘  └─────────┘
```

---

## Technical Notes

- **Query:** `prisma.task.findMany({ where: { userId }, include: { bill: true }, orderBy: { dueDate: 'asc' } })`
- **Server Component:** Use React Server Component for dashboard page (better performance)
- **Client Component:** TaskCard is client component for click interactivity
- **Navigation:** Task cards link to `/tasks/[id]` detail page (Epic 4)
- **Icons:** Bill type icons from lib/billTypes.ts
- **Currency:** Thai Baht (฿) with 2 decimal places

---

## Dependencies

**Upstream:**

- Epic 2 US-2.1: Tasks must exist to display
- Epic 9 (Login & Auth): User authentication required
- Epic 8 (Profile & Icons): Bill type icons

**Downstream:**

- Epic 4 (Task Actions): Task detail page (`/tasks/[id]`)
- Epic 5 (Dashboard): Advanced filtering and status views

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Dashboard displays tasks correctly
- [ ] Task cards show all required information
- [ ] Empty state handled gracefully
- [ ] Tasks filtered to current user only
- [ ] Tasks sorted by due date
- [ ] Clicking task navigates to detail page
- [ ] Responsive design (mobile, tablet, desktop)
- [ ] Unit tests passing
- [ ] E2E tests passing
- [ ] Code reviewed and merged

---

## Performance Considerations

- **Database Indexes:** Index on `user_id` and `status` for fast queries
- **Query Optimization:** Use `include` instead of separate queries
- **Target Load Time:** <500ms for 50 tasks
- **Pagination:** Consider implementing if task count exceeds 100

---

## Accessibility

- [ ] Semantic HTML (proper heading hierarchy)
- [ ] ARIA labels for status badges
- [ ] Keyboard navigation support
- [ ] Screen reader friendly task descriptions
- [ ] Sufficient color contrast for status badges

---

## Notes

- **Critical path** for 4-hour MVP demo
- Server Component for initial data fetch (performance)
- Client Component for interactivity (click handlers)
- Currency formatting uses Thai Baht (฿)
- Date formatting uses readable format (e.g., "Oct 15, 2025")
- Task detail view implemented in Epic 4
