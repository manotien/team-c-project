# Story 6.2: Display User Payment Card with Avatar

**Epic:** [Epic 6: Monthly Summary](epic-6-monthly-summary.md)
**Story ID:** US-6.2
**Priority:** Medium (P2)
**Status:** Draft

---

## Story

**As a** user,
**I want** to see a card with my payment total and avatar,
**so that** I can see my personal contribution to bill payments.

---

## Acceptance Criteria

1. User card displayed within monthly summary section
2. Card shows user's profile avatar (from LINE profile)
3. Card shows user's display name
4. Card shows total amount paid this month: "à¸¿4,850.00"
5. Card shows number of bills paid: "5 bills"
6. Visual indicator (icon or label) for payment contribution
7. Avatar displayed as circular image
8. Fallback avatar if user has no profile image (initials or default icon)
9. Card styled with border, shadow, or background color
10. Responsive layout (stacks on mobile, side-by-side on desktop)

---

## Tasks / Subtasks

- [ ] Create UserPaymentCard component (AC: 1, 9, 10)
  - [ ] Create `components/summaries/UserPaymentCard.tsx`
  - [ ] Design card layout with avatar and payment info
  - [ ] Apply styling with border, shadow, background
  - [ ] Implement responsive layout (mobile/desktop)

- [ ] Implement avatar display (AC: 2, 7, 8)
  - [ ] Fetch user avatar URL from user profile
  - [ ] Display avatar as circular image using Next.js Image component
  - [ ] Implement fallback avatar logic
  - [ ] Show user initials or default icon if no avatar
  - [ ] Handle avatar loading errors gracefully

- [ ] Display user information (AC: 3, 4, 5, 6)
  - [ ] Fetch and display user's display name
  - [ ] Show total amount paid this month (reuse from US-6.1)
  - [ ] Show bill count with proper formatting
  - [ ] Add visual indicator icon or label

- [ ] Integrate with monthly summary (AC: 1)
  - [ ] Add UserPaymentCard to dashboard monthly summary section
  - [ ] Position appropriately with MonthlySummaryCard
  - [ ] Ensure consistent data source with US-6.1

- [ ] Handle edge cases and testing
  - [ ] Test with user having avatar
  - [ ] Test with user having no avatar (fallback)
  - [ ] Test avatar loading failures
  - [ ] Test responsive layout on different screen sizes
  - [ ] Verify initials generation for fallback

---

## Dev Notes

### Technical Context

**Tech Stack:**
- Frontend: Next.js React Server Component
- Database: Prisma ORM
- UI: Next.js Image component, shadcn/ui Avatar component (optional)
- Styling: Tailwind CSS

**Integration Points:**
- Dashboard page: `app/(dashboard)/dashboard/page.tsx`
- User profile data (Epic 9): Requires `user.name` and `user.avatarUrl`
- Monthly payment summary (US-6.1): Shares calculation logic

**Database Query:**

```typescript
const user = await prisma.user.findUnique({
  where: { id: userId },
  select: {
    name: true,
    avatarUrl: true
  }
});

// Payment data (reuse from US-6.1)
const { total, count } = await getMonthlyPaymentSummary(userId);
```

**Component Location:**
- Component: `components/summaries/UserPaymentCard.tsx`
- Avatar component: `components/ui/Avatar.tsx` (consider using shadcn/ui)

**Key Implementation Details:**
- Use Next.js Image component for avatar optimization
- Generate fallback initials from user name (first letter or first+last)
- Default icon: Consider using a user icon from lucide-react or similar
- Avatar styling: `rounded-full` for circular shape
- Responsive grid: Use Tailwind CSS grid or flex with responsive breakpoints

**Avatar Fallback Logic:**
```typescript
function getAvatarFallback(name: string): string {
  if (!name) return 'ðŸ‘¤';

  const initials = name
    .split(' ')
    .map(n => n[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);

  return initials || 'ðŸ‘¤';
}
```

**Styling Guidelines:**
- Avatar size: 64px-80px diameter
- Card padding: Generous spacing for visual comfort
- Border: Subtle border or shadow for definition
- Colors: Use brand colors or neutral palette
- Responsive: Stack vertically on mobile (<768px), horizontal on desktop

**Performance Considerations:**
- Use Next.js Image component with proper sizing
- Lazy load avatar if below the fold
- Handle slow-loading LINE CDN avatars with loading state
- Consider caching avatar locally (future enhancement)

**LINE Avatar Integration:**
- Avatar URL comes from LINE profile during authentication
- Format: HTTPS URL to LINE CDN
- Handle CORS if needed (Next.js Image handles this)
- Fallback if LINE service unavailable

### Testing

**Test Location:** `__tests__/components/summaries/UserPaymentCard.test.tsx`

**Testing Standards:**
- Unit tests for avatar fallback logic
- Component rendering tests with React Testing Library
- Integration tests with user data
- Visual regression tests for responsive layout

**Testing Frameworks:**
- Vitest for unit tests
- React Testing Library for component tests
- Mock Prisma client for user data
- Mock Next.js Image component if needed

**Specific Test Cases:**
1. Displays user avatar when avatarUrl provided
2. Shows fallback initials when no avatar
3. Shows default icon when no name or avatar
4. Displays user name correctly
5. Shows payment total formatted properly
6. Shows bill count with correct singular/plural
7. Renders circular avatar shape
8. Responsive layout works on mobile and desktop
9. Handles avatar loading errors gracefully
10. Avatar fallback initials generated correctly

**Mock Data Example:**
```typescript
const mockUser = {
  id: 'user1',
  name: 'John Doe',
  avatarUrl: 'https://profile.line-scdn.net/...'
};

const mockPaymentSummary = {
  total: 4850.00,
  count: 5
};

// Expected fallback initials: 'JD'
```

**Visual Testing:**
- Avatar displays as perfect circle
- Fallback background color contrasts with initials
- Card layout aligns properly with MonthlySummaryCard
- Mobile stacking works correctly
- Desktop side-by-side layout maintains alignment

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-05 | 1.0 | Story created from Epic 6 | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

---

## QA Results

_To be populated by QA agent_
