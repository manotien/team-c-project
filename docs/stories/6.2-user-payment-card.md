# User Story 6.2: Display User Payment Card with Avatar

**Story ID:** US-6.2
**Epic:** [EPIC-6: Monthly Summary](epic-6-monthly-summary.md)
**Priority:** Medium (P2)
**Status:** Ready for Development

---

## User Story

**As a** user
**I want to** see a card with my payment total and avatar
**So that** I can see my personal contribution to bill payments

---

## Story Context

**Existing System Integration:**
- Integrates with: User profile system (Epic 9), Task payment data (Epic 4)
- Technology: Next.js Server Components, Prisma, React, shadcn/ui
- Follows pattern: User profile components with avatar display
- Touch points: User model (name, avatarUrl), Task payment summary, Dashboard UI

---

## Acceptance Criteria

**Functional Requirements:**

1. User card displayed within monthly summary section
2. Card shows user's profile avatar (from LINE profile)
3. Card shows user's display name
4. Card shows total amount paid this month: "฿4,850.00"
5. Card shows number of bills paid: "5 bills"
6. Visual indicator (icon or label) for payment contribution
7. Avatar displayed as circular image
8. Fallback avatar if user has no profile image (initials or default icon)
9. Card styled with border, shadow, or background color
10. Responsive layout (stacks on mobile, side-by-side on desktop)

**Integration Requirements:**

11. Existing user profile functionality continues to work unchanged
12. New functionality follows existing avatar display pattern
13. Integration with user and task systems maintains current behavior

**Quality Requirements:**

14. Change is covered by appropriate tests
15. Documentation is updated if needed
16. No regression in existing functionality verified

---

## Technical Notes

**User Data Query:**
```typescript
const user = await prisma.user.findUnique({
  where: { id: userId },
  select: { name: true, avatarUrl: true }
});
```

**Payment Summary Calculation:**
```typescript
// Reuse calculation from US-6.1
const paidTasks = await prisma.task.findMany({
  where: {
    userId,
    status: 'PAID',
    paidAt: { gte: startOfMonth, lte: endOfMonth }
  },
  include: { bill: true }
});

const total = paidTasks.reduce((sum, task) => sum + Number(task.bill.amount), 0);
const count = paidTasks.length;
```

- **Integration Approach:** Combine user profile data with payment summary from US-6.1
- **Component Location:** `components/summaries/UserPaymentCard.tsx`
- **Avatar Component:** Use `components/ui/Avatar.tsx` (from shadcn/ui)
- **Existing Pattern Reference:** Follow user profile avatar patterns
- **Key Constraints:**
  - Use Next.js Image component for avatar optimization
  - Fallback: Show first letter of name or default icon if no avatarUrl
  - Avatar loading timeout: 3 seconds before fallback

---

## Risk and Compatibility Check

**Minimal Risk Assessment:**
- **Primary Risk:** Avatar loading slow from LINE CDN
- **Mitigation:** Use Next.js Image component with optimization, fallback to default avatar if LINE image fails
- **Rollback:** Remove component from dashboard, no data modifications needed

**Compatibility Verification:**
- [x] No breaking changes to existing APIs
- [x] Database changes (if any) are additive only (no schema changes)
- [x] UI changes follow existing design patterns (avatar components)
- [x] Performance impact is negligible (single user query)

---

## Definition of Done

- [ ] Functional requirements met (AC 1-10)
- [ ] Integration requirements verified (AC 11-13)
- [ ] Existing functionality regression tested
- [ ] Code follows existing patterns and standards
- [ ] Tests pass (existing and new)
- [ ] Avatar displayed correctly (circular, optimized)
- [ ] Fallback avatar works when no profile image
- [ ] Responsive layout verified on mobile and desktop
- [ ] Currency formatting consistent (฿ symbol, 2 decimals)
- [ ] Documentation updated if applicable

---

## Dependencies

**Upstream Dependencies:**
- Epic 4 (Task Actions): Requires payment data from tasks
- Epic 9 (Login & Auth): Requires user profile data (name, avatar)

---

## Notes

- **UI Framework:** Use shadcn/ui Card and Avatar components
- **Image Optimization:** Next.js Image component for avatar
- **Fallback Strategy:** First letter of name → Default icon → Generic avatar
- **Future Enhancements:**
  - User profile editing from card
  - Payment history modal on card click
  - Badges for payment milestones
